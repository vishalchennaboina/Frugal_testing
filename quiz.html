<!doctype html>
<html lang="en">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>Dynamic Quiz App — JavaScript Only</title>


    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>

    <style>
        :root{
            --bg:#f4f7fb;
            --card:#ffffff;
            --accent: #0f0e1a;

            --muted:#6b7280;
            --success:#10b981;
            --danger:#ef4444;
            --radius:12px;
            font-family: Inter, system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial;
        }
        *{box-sizing:border-box}
        body{
            margin:0;background:linear-gradient(180deg,var(--bg),#eef2ff 120px);
            min-height:100vh;display:flex;align-items:flex-start;justify-content:center;padding:28px;
            color:#0f172a;
        }

        .container{
            width:100%;max-width:980px;background:transparent;
        }

        .card{
            background:var(--card);border-radius:var(--radius);box-shadow:0 8px 30px rgba(15,23,42,0.06);
            padding:20px;margin-bottom:18px;
        }

        header .title{display:flex;align-items:center;gap:12px}
        header h1{margin:0;font-size:20px}
        header p{margin:4px 0 0;color:var(--muted);font-size:13px}


        .controls{display:flex;gap:12px;flex-wrap:wrap;margin-top:16px}
        select, input[type=number], button{
            padding:10px 12px;border-radius:10px;border:1px solid #e6eef8;background:#fff;font-size:14px;
        }
        button{
            background:var(--accent);color:white;border:none;cursor:pointer;box-shadow:0 6px 18px rgba(79,70,229,0.08);
        }
        button.secondary{background:transparent;border:1px solid #e6e9ff;color:var(--accent)}
        .flex-row{display:flex;gap:12px;align-items:center}


        .quiz-area{display:none}
        .topbar{display:flex;justify-content:space-between;align-items:center;margin-bottom:12px;}
        .timer{
            display:flex;gap:8px;align-items:center;font-weight:600;color:var(--accent);
            background:linear-gradient(90deg,#fff,#fafaff);padding:6px 10px;border-radius:10px;border:1px solid #eef2ff;
        }
        .question{
            font-size:18px;margin-bottom:14px;
        }
        .choices{display:grid;gap:10px}
        .choice{
            padding:10px 12px;border-radius:10px;border:1px solid #e6eef8;background:#fff;cursor:pointer;
        }
        .choice.selected{border-color:var(--accent);box-shadow:0 6px 18px rgba(79,70,229,0.08)}
        .nav{display:flex;justify-content:space-between;gap:12px;margin-top:16px}
        .progress{font-size:13px;color:var(--muted)}

        /* results */
        .results{display:none}
        .stats{display:flex;flex-wrap:wrap;gap:12px}
        .stat-card{flex:1;min-width:160px;padding:12px;border-radius:10px;background:#fff;border:1px solid #f0f4ff}
        .small{font-size:13px;color:var(--muted)}
        table{width:100%;border-collapse:collapse;margin-top:12px}
        th,td{padding:8px;border-bottom:1px solid #f1f5f9;text-align:left;font-size:14px}
        .correct{color:var(--success);font-weight:600}
        .wrong{color:var(--danger);font-weight:600}


        @media (max-width:700px){
            body{padding:14px}
            .question{font-size:16px}
            .controls{flex-direction:column;align-items:stretch}
        }
    </style>
</head>
<body>
<div class="container">
    <div class="card" id="setupCard">
        <div class="title">
            <div>
                <h1>Dynamic Quiz Application</h1>
                <p>Select category & difficulty, then start. Timer per question & results analysis included.</p>
            </div>
        </div>

        <div class="controls" style="margin-top:16px">
            <div class="flex-row">
                <label for="category" class="small" style="margin-right:8px">Category</label>
                <select id="category">
                    <option value="general">General Knowledge</option>
                    <option value="programming">Programming</option>
                    <option value="math">Math</option>
                </select>
            </div>

            <div class="flex-row">
                <label for="difficulty" class="small" style="margin-right:8px">Difficulty</label>
                <select id="difficulty">
                    <option value="easy">Easy</option>
                    <option value="medium" selected>Medium</option>
                    <option value="hard">Hard</option>
                </select>
            </div>

            <div class="flex-row">
                <label for="qcount" class="small" style="margin-right:8px">Questions</label>
                <input id="qcount" type="number" min="1" max="20" value="5" />
            </div>

            <div style="margin-left:auto">
                <button id="startBtn">Start Quiz</button>
            </div>
        </div>
    </div>

    <div class="card quiz-area" id="quizCard" aria-live="polite">
        <div class="topbar">
            <div class="progress"><span id="progressText">Question 1 / 5</span></div>
            <div class="timer" aria-hidden="false"><span id="timerLabel">00:20</span></div>
        </div>

        <div>
            <div class="question" id="questionText">Question text</div>
            <div class="choices" id="choices"></div>

            <div class="nav">
                <div style="display:flex;gap:8px">
                    <button class="secondary" id="prevBtn">Previous</button>
                    <button class="secondary" id="nextBtn">Next</button>
                </div>

                <div style="display:flex;align-items:center;gap:8px">
                    <div class="small">Auto-submit when timer hits zero</div>
                    <button id="submitBtn">Submit Quiz</button>
                </div>
            </div>
        </div>
    </div>

    <div class="card results" id="resultsCard">
        <h2>Results</h2>

        <div class="stats" style="margin-top:10px">
            <div class="stat-card">
                <div class="small">Score</div>
                <div style="font-size:20px;font-weight:700" id="scoreText">0 / 0</div>
                <div class="small" id="percentText">0%</div>
            </div>

            <div class="stat-card">
                <div class="small">Correct</div>
                <div style="font-size:20px;font-weight:700" id="correctCount">0</div>
            </div>

            <div class="stat-card">
                <div class="small">Incorrect</div>
                <div style="font-size:20px;font-weight:700" id="wrongCount">0</div>
            </div>

            <div class="stat-card">
                <div class="small">Average time / Q</div>
                <div style="font-size:20px;font-weight:700" id="avgTime">0s</div>
            </div>
        </div>

        <div style="display:flex;gap:18px;flex-wrap:wrap;margin-top:18px">
            <div style="flex:1;min-width:260px" class="card">
                <canvas id="pieChart" height="200"></canvas>
            </div>

            <div style="flex:2;min-width:320px" class="card">
                <canvas id="barChart" height="200"></canvas>
            </div>
        </div>

        <div class="card" style="margin-top:16px">
            <h3>Question Breakdown</h3>
            <table id="breakdownTable">
                <thead><tr><th>#</th><th>Question</th><th>Your Answer</th><th>Correct Answer</th><th>Time (s)</th></tr></thead>
                <tbody></tbody>
            </table>
        </div>

        <div style="margin-top:12px;display:flex;gap:8px">
            <button id="restartBtn">Take another quiz</button>
        </div>
    </div>

</div>

<script>

    const QUESTION_POOL = [

        {id:1, category:'general', difficulty:'easy', question:'What is the capital of France?', options:['Rome','Madrid','Paris','Berlin'], answer:2},
        {id:2, category:'general', difficulty:'medium', question:'Which gas do plants primarily take in for photosynthesis?', options:['Oxygen','Carbon Dioxide','Nitrogen','Hydrogen'], answer:1},
        {id:3, category:'general', difficulty:'easy', question:'Which planet is known as the Red Planet?', options:['Earth','Mars','Venus','Saturn'], answer:1},
        {id:4, category:'general', difficulty:'medium', question:'Who discovered gravity?', options:['Albert Einstein','Isaac Newton','Galileo Galilei','Nikola Tesla'], answer:1},
        {id:5, category:'general', difficulty:'hard', question:'Who wrote "The Republic"?', options:['Aristotle','Plato','Socrates','Pythagoras'], answer:1},
        {id:6, category:'general', difficulty:'hard', question:'What is the chemical formula for table salt?', options:['NaCl','KCl','CaCO3','H2SO4'], answer:0},


        {id:7, category:'programming', difficulty:'easy', question:'Which language runs in a web browser?', options:['Python','C++','JavaScript','Java'], answer:2},
        {id:8, category:'programming', difficulty:'easy', question:'What does HTML stand for?', options:['Hyper Trainer Marking Language','Hyper Text Markup Language','Hyper Text Making Line','Hyperlink Text Management Language'], answer:1},
        {id:9, category:'programming', difficulty:'medium', question:'Which HTML tag is used to link JavaScript?', options:['<script>','<css>','<link>','<javascript>'], answer:0},
        {id:10, category:'programming', difficulty:'medium', question:'Which company developed the Java programming language?', options:['Microsoft','Sun Microsystems','Google','IBM'], answer:1},
        {id:11, category:'programming', difficulty:'hard', question:'Which sorting algorithm is generally stable and O(n log n)?', options:['QuickSort','HeapSort','MergeSort','SelectionSort'], answer:2},
        {id:12, category:'programming', difficulty:'hard', question:'Which of the following is NOT an OOP concept?', options:['Encapsulation','Polymorphism','Recursion','Inheritance'], answer:2},


        {id:13, category:'math', difficulty:'easy', question:'What is 7 + 6?', options:['13','14','12','11'], answer:0},
        {id:14, category:'math', difficulty:'easy', question:'What is the value of 5 × 4?', options:['9','20','15','40'], answer:1},
        {id:15, category:'math', difficulty:'medium', question:'What is the derivative of x²?', options:['2x','x','x²','2'], answer:0},
        {id:16, category:'math', difficulty:'medium', question:'What is the value of √144?', options:['10','11','12','14'], answer:2},
        {id:17, category:'math', difficulty:'hard', question:'Integral of 1/x dx equals?', options:['ln|x| + C','1/x + C','x + C','e^x + C'], answer:0},
        {id:18, category:'math', difficulty:'hard', question:'What is the derivative of sin(x)?', options:['cos(x)','-sin(x)','-cos(x)','tan(x)'], answer:0},
        {id:19, category:'math', difficulty:'hard', question:'What is the limit of (1 + 1/n)^n as n → ∞ ?', options:['0','1','∞','e'], answer:3},


        {id:20, category:'general', difficulty:'medium', question:'Which ocean is the largest in the world?', options:['Atlantic Ocean','Indian Ocean','Pacific Ocean','Arctic Ocean'], answer:2}
    ];



    let state = {
        selectedQuestions: [],
        currentIndex: 0,
        perQuestionTimeLimit: 20,
        timerId: null,
        timeLeft: 0,
        quizStarted: false,
        startedAt: null,
        finishedAt: null
    };


    const startBtn = document.getElementById('startBtn');
    const categorySel = document.getElementById('category');
    const difficultySel = document.getElementById('difficulty');
    const qcountInput = document.getElementById('qcount');
    const secondsInput = document.getElementById('seconds');

    const setupCard = document.getElementById('setupCard');
    const quizCard = document.getElementById('quizCard');
    const resultsCard = document.getElementById('resultsCard');

    const progressText = document.getElementById('progressText');
    const timerLabel = document.getElementById('timerLabel');
    const questionText = document.getElementById('questionText');
    const choicesDiv = document.getElementById('choices');
    const prevBtn = document.getElementById('prevBtn');
    const nextBtn = document.getElementById('nextBtn');
    const submitBtn = document.getElementById('submitBtn');

    const scoreText = document.getElementById('scoreText');
    const percentText = document.getElementById('percentText');
    const correctCountEl = document.getElementById('correctCount');
    const wrongCountEl = document.getElementById('wrongCount');
    const avgTimeEl = document.getElementById('avgTime');
    const breakdownTableBody = document.querySelector('#breakdownTable tbody');

    const restartBtn = document.getElementById('restartBtn');
    const downloadBtn = document.getElementById('downloadBtn');


    let pieChart = null;
    let barChart = null;


    function shuffle(arr){
        for(let i=arr.length-1;i>0;i--){
            const j = Math.floor(Math.random()*(i+1));
            [arr[i],arr[j]]=[arr[j],arr[i]];
        }
        return arr;
    }


    function buildQuestionSet(category, difficulty, count){
        // filter
        let pool = QUESTION_POOL.filter(q => (q.category === category) && (q.difficulty === difficulty));
        if(pool.length < count){

            const fallback = QUESTION_POOL.filter(q => q.category === category && q.difficulty !== difficulty);
            pool = pool.concat(fallback);
        }

        if(pool.length < count) pool = pool.concat(QUESTION_POOL);


        pool = shuffle(pool.slice());
        const chosen = pool.slice(0, Math.min(count, pool.length));
        // Map to state entries
        return chosen.map(q => ({ qobj: q, chosenIndex: null, timeSpent: 0 }));
    }


    function formatTime(sec){
        const s = Math.floor(sec % 60).toString().padStart(2,'0');
        const m = Math.floor(sec / 60).toString().padStart(2,'0');
        return m+':'+s;
    }


    startBtn.addEventListener('click', () => {
        const category = categorySel.value;
        const difficulty = difficultySel.value;
        const qcount = Math.max(1, Math.min(20, parseInt(qcountInput.value) || 5));
        // Auto assign time limit based on difficulty
        if (difficulty === 'easy') seconds = 20;
        if (difficulty === 'medium') seconds = 25;
        if (difficulty === 'hard') seconds = 30;






        state.selectedQuestions = buildQuestionSet(category, difficulty, qcount);
        state.currentIndex = 0;
        state.perQuestionTimeLimit = seconds;
        state.quizStarted = true;
        state.startedAt = Date.now();
        // hide setup, show quiz
        setupCard.style.display = 'none';
        resultsCard.style.display = 'none';
        quizCard.style.display = 'block';

        renderCurrentQuestion();
        startTimerForCurrent();
    });

    function renderCurrentQuestion(){
        const idx = state.currentIndex;
        const total = state.selectedQuestions.length;
        progressText.textContent = `Question ${idx+1} / ${total}`;

        const item = state.selectedQuestions[idx];
        questionText.textContent = item.qobj.question;


        choicesDiv.innerHTML = '';
        item.qobj.options.forEach((opt, i) => {
            const btn = document.createElement('div');
            btn.className = 'choice';
            btn.setAttribute('role','button');
            btn.setAttribute('tabindex',0);
            btn.dataset.index = i;
            btn.innerHTML = `<div>${String.fromCharCode(65+i)}. ${opt}</div>`;
            if(item.chosenIndex === i) btn.classList.add('selected');

            btn.addEventListener('click', () => {
                onChooseOption(i);
            });
            btn.addEventListener('keydown', (e) => {
                if(e.key === 'Enter' || e.key === ' ') onChooseOption(i);
            });

            choicesDiv.appendChild(btn);
        });


        timerLabel.textContent = formatTime(state.timeLeft || state.perQuestionTimeLimit);
    }

    function onChooseOption(choiceIdx){
        const idx = state.currentIndex;
        const item = state.selectedQuestions[idx];
        // mark chosen, but do not submit quiz until user clicks next or timer ends
        item.chosenIndex = choiceIdx;
        // re-render choices to show selection
        Array.from(choicesDiv.children).forEach(child => {
            child.classList.toggle('selected', parseInt(child.dataset.index) === choiceIdx);
        });
    }

    // Timer logic: start timer for current question
    function startTimerForCurrent(){
        clearTimer();
        state.timeLeft = state.perQuestionTimeLimit;
        const startTime = Date.now();
        timerLabel.textContent = formatTime(state.timeLeft);

        state.timerId = setInterval(() => {
            const elapsed = Math.floor((Date.now() - startTime) / 1000);
            const remaining = Math.max(0, state.perQuestionTimeLimit - elapsed);
            state.timeLeft = remaining;
            timerLabel.textContent = formatTime(remaining);

            if(remaining <= 0){
                // record zero time if user didn't click — but better record full allowed time
                recordTimeForCurrent(state.perQuestionTimeLimit);
                advanceToNextOrFinish();
            }
        }, 250);
    }

    // record elapsed time for the current question
    function recordTimeForCurrent(elapsedSec){
        const idx = state.currentIndex;
        if(state.selectedQuestions[idx]){
            state.selectedQuestions[idx].timeSpent += elapsedSec;
        }
    }

    // stop and clear timer
    function clearTimer(){
        if(state.timerId){
            clearInterval(state.timerId);
            state.timerId = null;
        }
    }

    // Navigate next/previous
    nextBtn.addEventListener('click', () => {
        // compute elapsed time since last timer start
        // We'll compute actual time spent by subtracting remaining from limit
        const used = state.perQuestionTimeLimit - state.timeLeft;
        recordTimeForCurrent(Math.max(1, Math.round(used))); // at least 1s to avoid zeros
        goToIndex(state.currentIndex + 1);
    });

    prevBtn.addEventListener('click', () => {
        const used = state.perQuestionTimeLimit - state.timeLeft;
        recordTimeForCurrent(Math.max(1, Math.round(used)));
        goToIndex(state.currentIndex - 1);
    });

    function goToIndex(newIdx){
        clearTimer();
        // clamp
        if(newIdx < 0) newIdx = 0;
        if(newIdx >= state.selectedQuestions.length) newIdx = state.selectedQuestions.length - 1;
        state.currentIndex = newIdx;
        renderCurrentQuestion();
        startTimerForCurrent();
    }

    // If timer auto-submits for a question, advance to next; if last, auto-submit full quiz
    function advanceToNextOrFinish(){
        clearTimer();
        // If user didn't choose, chosenIndex remains null
        const idx = state.currentIndex;
        // If last question -> finish
        if(idx === state.selectedQuestions.length - 1){
            finishQuiz();
        } else {
            state.currentIndex += 1;
            renderCurrentQuestion();
            startTimerForCurrent();
        }
    }

    // Submit Quiz
    submitBtn.addEventListener('click', finishQuiz);

    function finishQuiz(){
        clearTimer();
        state.finishedAt = Date.now();
        // compute remaining time for current question as used
        const used = state.perQuestionTimeLimit - state.timeLeft;
        if(used > 0) recordTimeForCurrent(Math.max(1, Math.round(used)));

        // For any remaining unanswered questions, we keep chosenIndex null and timeSpent as recorded
        state.quizStarted = false;
        quizCard.style.display = 'none';
        resultsCard.style.display = 'block';
        renderResults();
    }

    // Results calculation & rendering
    function renderResults(){
        const total = state.selectedQuestions.length;
        let correct = 0;
        let wrong = 0;
        let totalTime = 0;
        const labels = [];
        const times = [];
        const answers = [];

        state.selectedQuestions.forEach((item, i) => {
            const correctIndex = item.qobj.answer;
            const chosen = item.chosenIndex;
            const isCorrect = (chosen === correctIndex);
            if(chosen === null || chosen === undefined) {
                wrong++;
            } else if(isCorrect) correct++;
            else wrong++;

            totalTime += item.timeSpent || 0;
            labels.push(`Q ${i+1}`);
            times.push(Math.round(item.timeSpent || 0));
            answers.push({ question: item.qobj.question, chosen: chosen === null ? null : item.qobj.options[chosen], correct: item.qobj.options[correctIndex], time: Math.round(item.timeSpent || 0), isCorrect });
        });

        const percent = Math.round((correct / total) * 100);

        scoreText.textContent = `${correct} / ${total}`;
        percentText.textContent = `${percent}%`;
        correctCountEl.textContent = correct;
        wrongCountEl.textContent = wrong;
        avgTimeEl.textContent = total > 0 ? Math.round(totalTime / total) + 's' : '0s';

        // breakdown table
        breakdownTableBody.innerHTML = '';
        answers.forEach((a, idx) => {
            const tr = document.createElement('tr');
            tr.innerHTML = `
        <td>${idx+1}</td>
        <td style="max-width:260px">${a.question}</td>
        <td>${a.chosen === null ? '<em>Unanswered</em>' : a.chosen}</td>
        <td>${a.correct}</td>
        <td>${a.time}s</td>
      `;
            if(a.isCorrect) tr.querySelector('td:nth-child(3)').classList.add('correct');
            else tr.querySelector('td:nth-child(3)').classList.add('wrong');
            breakdownTableBody.appendChild(tr);
        });

        // Charts
        renderCharts(correct, wrong, labels, times);
    }

    function renderCharts(correct, wrong, labels, times){
        // Destroy old charts
        if(pieChart){ pieChart.destroy(); pieChart = null; }
        if(barChart){ barChart.destroy(); barChart = null; }

        const pieCtx = document.getElementById('pieChart').getContext('2d');
        pieChart = new Chart(pieCtx, {
            type: 'pie',
            data: {
                labels: ['Correct','Wrong'],
                datasets: [{
                    data: [correct, wrong],
                    backgroundColor: ['#10b981','#ef4444']
                }]
            },
            options: {
                plugins: {legend: {position:'bottom'}}
            }
        });

        const barCtx = document.getElementById('barChart').getContext('2d');
        barChart = new Chart(barCtx, {
            type: 'bar',
            data: {
                labels: labels,
                datasets: [{
                    label: 'Time spent (s)',
                    data: times,
                    // color unspecified (Chart.js will pick defaults)
                }]
            },
            options: {
                scales: {
                    x: {title: {display:false}},
                    y: {title: {display:true, text:'Seconds'}}
                },
                plugins: {
                    legend: {display:false}
                }
            }
        });
    }

    // Restart
    restartBtn.addEventListener('click', () => {
        // reset UI
        resultsCard.style.display = 'none';
        setupCard.style.display = 'block';
    });

    // Download results JSON
    downloadBtn.addEventListener('click', () => {
        const payload = {
            generatedAt: new Date().toISOString(),
            settings: { perQuestionTimeLimit: state.perQuestionTimeLimit, totalQuestions: state.selectedQuestions.length },
            results: state.selectedQuestions.map((it, idx) => ({
                index: idx+1,
                question: it.qobj.question,
                options: it.qobj.options,
                chosenIndex: it.chosenIndex,
                chosen: it.chosenIndex === null ? null : it.qobj.options[it.chosenIndex],
                correctIndex: it.qobj.answer,
                correct: it.qobj.options[it.qobj.answer],
                timeSpent: it.timeSpent
            }))
        };
        const blob = new Blob([JSON.stringify(payload, null, 2)], {type:'application/json'});
        const url = URL.createObjectURL(blob);
        const a = document.createElement('a');
        a.href = url;
        a.download = 'quiz-results.json';
        a.click();
        URL.revokeObjectURL(url);
    });

    // clean up timers when leaving page
    window.addEventListener('beforeunload', () => { clearTimer(); });

    // Accessibility: keyboard shortcuts
    document.addEventListener('keydown', (e) => {
        if(!state.quizStarted) return;
        if(e.key === 'ArrowRight') nextBtn.click();
        if(e.key === 'ArrowLeft') prevBtn.click();
    });

</script>
</body>
</html>
